<h1>Report</h1>

<h2>Totals By Job</h2>
<table>
  <tr>
    <th>Job</th>
    <th>Total Hours</th>
  </tr>

<% job_totals.each do |total| %>
  <tr>
    <td><%= total.name %></td>
    <td><%= '%.2f' % total.hours %></td>
  </tr>

<% end %>

</table>
<br>
<table>
  <tr>
  	    <th>Job</th>

<% job_totals.each do |total| %>
    <th><%= total.name %></th>

<% end %>
  </tr>
<tr>
	    <th>Total Hours</th>
<% job_totals.each do |total| %>
    <td><%= '%.2f' % total.hours %></td>

<% end %>
  </tr>


</table>

<h2>All Events</h2>	
	<div class="field">
    <%= collection_select(:event, :employee_id, @employees, :id, :firstname, {:prompt => true}) %>  
</div>
<div class="field">
    <%= collection_select(:event, :job_id, @jobs, :id, :name, {:prompt => true}) %>  
</div>
<table id="periods">
  <tr>
    <th>User</th>
    <th>Job</th>
    <th>In</th>
    <th>Out</th>
    <th>Length</th>
    <th>Log</th>

  </tr>

<% @periods.each do |period| %>
  <tr>
    <td><%= period[:employee].firstname %> <%= period[:employee].lastname %></td>
    <td><%= period[:job].name %></td>
    <td><%= period[:in] %></td>
    <td><%= period[:out] %></td>
    <td><%= '%.2f' % period[:length] if period[:length] != nil %></td>
    <td><%= period[:log] %></td>

  </tr>

<% end %>

</table>

<br />

<h2>Totals matrix</h2>
<table id="matrix">
  <tr>
    <td></td>
    <% @jobs.each do |job| %>
    <td><%= job[:name] %></td>
    <% end %>
    <td>Total</td>
  </tr>
  <% @employees.each do |employee| %>
  <tr>
    <td>
      <%= employee[:firstname] %> <%= employee[:lastname] %>
    </td>
    <% @jobs.each do |job| %>
    <td></td>
    <% end %>
  </tr>
  <% end %>
  <tr>
    <td>Total</td>
        <% @jobs.each do |job| %>
    <td></td>
    <% end %>
    <td></td>
  </tr>
</table>


  <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
      totals();
    });

    function totals() {
      $.getJSON("report.json", function(json){
       total = 0;
       $.each(json, function(n) {
        if(json[n].length) {total += json[n].length}
       })
       console.log(total)
       totalRow = $(jQuery('<tr class="totals"><td>Total:</td><td></td><td></td><td></td><td>' + (total).toFixed(2) + '</td><td></td></tr>'))
       $('#periods tbody').append(totalRow)
       $('#matrix td').last().html((total).toFixed(2));
     });

    }
  </script>
